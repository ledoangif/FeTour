{"version":3,"file":"index-D0re39W_.js","sources":["../../../../pages/paymentResponse/index.vue"],"sourcesContent":["<template>\r\n    <HeaderHome />\r\n    <section class=\"banner_inner\" id=\"home\">\r\n        <div class=\"banner_inner_overlay\"></div>\r\n    </section>\r\n  <div class=\"fs-5 border-bottom py-4\">\r\n    <div class=\"container d-flex flex-row\">\r\n      <div class=\"me-2 text-primary\">1. Nhập thông tin ></div>\r\n      <div class=\"me-2 text-primary\">2. Đặt cọc ></div>\r\n      <div class=\"text-primary\">3. Kết quả</div>\r\n    </div>\r\n  </div>\r\n  \r\n  <div class=\"container payment-response mt-4\">\r\n    <h1 class=\"text-center\">Kết quả đặt tour</h1>\r\n    <div v-if=\"isSuccess\">\r\n      <h2 class=\"text-success text-center\">Đặt tour thành công!</h2>\r\n      <table class=\"table table-bordered mt-3\">\r\n        <thead class=\"table-light\">\r\n          <tr>\r\n            <th>Thông tin</th>\r\n            <th>Giá trị</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          <tr>\r\n            <td>Mã đặt tour</td>\r\n            <td>{{ orderDescription }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td>Mã giao dịch</td>\r\n            <td>{{ transactionId }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td>ID đơn hàng</td>\r\n            <td>{{ orderId }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td>Số tiền đặt cọc</td>\r\n            <td>100.000 vnd</td>\r\n          </tr>\r\n          <!-- <tr>\r\n            <td>Phương thức thanh toán</td>\r\n            <td>{{ paymentMethod }}</td>\r\n          </tr> -->\r\n          <tr>\r\n            <td>ID thanh toán</td>\r\n            <td>{{ paymentId }}</td>\r\n          </tr>\r\n          <!-- <tr>\r\n            <td>Mã phản hồi VnPay</td>\r\n            <td>{{ vnPayResponseCode }}</td>\r\n          </tr> -->\r\n          <tr>\r\n            <td>Trạng thái thanh toán</td>\r\n            <td>Thành công</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n      <h6>Thông tin đặt tour của bạn sẽ được gửi qua email bạn đã cung cấp .</h6>\r\n    </div>\r\n    <div v-else>\r\n      <h2 class=\"text-center text-danger\">Đặt tour thất bại!</h2>\r\n      <p class=\"text-center \">Vui lòng kiểm tra lại thông tin và thử lại.</p>\r\n      <!-- <p class=\"text-center\">Mã phản hồi VnPay: {{ vnPayResponseCode }}</p> -->\r\n    </div>\r\n  </div>\r\n\r\n  <br />\r\n  <Footer />\r\n</template>\r\n\r\n<script setup>\r\ndefinePageMeta({\r\n  layout: false,\r\n});\r\nimport { ref, onMounted } from 'vue'\r\nimport { useRoute } from 'vue-router'\r\nimport Api from '~/service/Base/api.ts'; // Đảm bảo đã có import Api\r\n\r\nconst api = new Api();\r\nconst route = useRoute()\r\nconst isSuccess = ref(false)\r\nconst orderDescription = ref('')\r\nconst transactionId = ref('')\r\nconst orderId = ref('')\r\nconst paymentMethod = ref('')\r\nconst paymentId = ref('')\r\nconst vnPayResponseCode = ref('')\r\nconst tourName = ref('') // Thêm biến này để chứa tên tour\r\n\r\nonMounted(async () => {\r\n  const params = route.query\r\n\r\n  isSuccess.value = params.success === 'true'\r\n  orderDescription.value = params.orderDescription || ''\r\n  transactionId.value = params.transactionId || ''\r\n  orderId.value = params.orderId || ''\r\n  paymentMethod.value = params.paymentMethod || ''\r\n  paymentId.value = params.paymentId || ''\r\n  vnPayResponseCode.value = params.vnPayResponseCode || ''\r\n\r\n  // Nếu thanh toán thành công, gọi hàm để cập nhật trạng thái booking\r\n  if (isSuccess.value && orderDescription.value) {\r\n    const bookingId = parseInt(orderDescription.value, 10); // Chuyển đổi thành số nguyên\r\n    await updateBookingStatus(bookingId); // Gọi API để cập nhật trạng thái\r\n  }\r\n})\r\n\r\nconst updateBookingStatus = async (bookingId) => {\r\n  try {\r\n    // Gửi yêu cầu PUT để cập nhật trạng thái của booking\r\n    const response = await api.putAPI(`/Booking/UpdateStatusToUnpaid?bookingId=${bookingId}`);\r\n    \r\n    if (response.status === 200) {\r\n      console.log('Cập nhật trạng thái thành công:', response.data);\r\n\r\n      // Lấy thông tin email và statusBill từ response.data\r\n      const { email, statusBill } = response.data;\r\n      // Sau khi cập nhật trạng thái thành công, gọi API để gửi email\r\n      const formData = new FormData();\r\n      formData.append('to', email); // Email khách hàng\r\n      formData.append('status', statusBill); // Trạng thái hiện tại của booking\r\n\r\n      // Gửi yêu cầu POST để gửi email\r\n      const mailResponse = await api.postAPI(`/Booking/TestSendMailByStatus?id=${bookingId}`, formData);\r\n      \r\n      if (mailResponse.status === 200) {\r\n        console.log('Email gửi thành công:', mailResponse.data);\r\n      } else {\r\n        console.error('Lỗi cập nhật trạng thái email:', error);\r\n      }\r\n    } else {\r\n      console.error('Lỗi cập nhật trạng thái booking:', error);\r\n    }\r\n  } catch (error) {\r\n    console.error('Lỗi cập nhật trạng thái booking:', error);\r\n  }\r\n};\r\n\r\n</script>\r\n<style scoped>\r\n@import '../../assets/css/bootstrap.css';\r\n@import '../../assets/css/style.css';\r\n@import '../../assets/css/font-awesome.min.css';\r\n@import '../../assets/css/css_slider.css';\r\n@import '../../assets/vendor/mdi-font/css/material-design-iconic-font.min.css';\r\n@import '../../assets/vendor/font-awesome-4.7/css/font-awesome.min.css';\r\n@import '../../assets/vendor/select2/select2.min.css';\r\n.payment-response {\r\n  max-width: 600px;\r\n  margin: auto;\r\n  text-align: center;\r\n}\r\ntable {\r\n  width: 100%;\r\n  border-collapse: collapse;\r\n  margin-top: 20px;\r\n}\r\n\r\nth, td {\r\n  border: 1px solid #ddd;\r\n  padding: 10px;\r\n  text-align: left;\r\n}\r\n\r\nth {\r\n  background-color: #f2f2f2;\r\n}\r\n\r\ntr:nth-child(even) {\r\n  background-color: #f9f9f9;\r\n}\r\n\r\ntr:hover {\r\n  background-color: #f1f1f1;\r\n}\r\n</style>\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiFc,aAAU;AACxB,UAAM,YAAY,IAAI,KAAK;AAC3B,UAAM,mBAAmB,IAAI,EAAE;AAC/B,UAAM,gBAAgB,IAAI,EAAE;AAC5B,UAAM,UAAU,IAAI,EAAE;AACA,QAAI,EAAE;AAC5B,UAAM,YAAY,IAAI,EAAE;AACE,QAAI,EAAE;AACf,QAAI,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;"}