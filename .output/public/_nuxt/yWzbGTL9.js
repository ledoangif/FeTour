import{_ as M,n as N,F as V,q as D,E as B,o as l,s as T,w as d,u as v,c as r,d as _,b as n,a as e,t as m,v as A,x as E,y as k,p as H,e as L,r as q,z as F,A as j,B as O,C as P,D as Q,G as X}from"./-qx6OsVB.js";import{_ as z}from"./bDhVN2i7.js";import{A as x}from"./Q_m3z1ei.js";import{_ as G}from"./DRJbnSa7.js";import{_ as J}from"./4ZpNe1Zk.js";const I=N.useToast(),f=new x,K={name:"CreateUpdateAccountModal",props:{editAccount:{type:Object,default:null,required:!1},isEditMode:{type:Boolean,default:!1,required:!0},data_bs_target_modal:{type:String,default:""},id_modal:{type:String,default:""},roles:{type:Array,default:null,required:!1}},data(){return{account:{id:"",email:"",password:"",fullName:"",phone:"",roleId:2},emailError:""}},watch:{editAccount:{immediate:!0,handler(t){t&&(this.account={...t})}}},methods:{async createAccount(){if(this.account.email===""){this.emailError="Thông tin này không được để trống!";return}try{const t=await f.get("/Account/email",{params:{email:this.account.email}});if(t.data&&t.data.responseData&&Object.keys(t.data.responseData).length>0){this.emailError="Email này đã tồn tại.";return}else this.emailError="";const o=await f.postAPI("/Account/register",this.account);o.status===200&&o.data&&o.data.message&&I.success(o.data.message),this.$emit("account-saved"),document.getElementById("closeModalButton").click()}catch(t){console.error(t)}},async updateAccount(){if(this.account.email===""){this.emailError="Thông tin này không được để trống!";return}try{const t=await f.get("/Account/email",{params:{email:this.account.email}});t.data&&t.data.responseData&&Object.keys(t.data.responseData).length>0&&this.account.email!==this.editAccount.email?this.emailError="Email này đã tồn tại.":this.emailError="";const o=await f.putAPI(`/Account/${this.editAccount.id}`,this.account);o.status===200&&o.data&&o.data.message&&I.success(o.data.message),this.$emit("account-saved"),document.getElementById("closeModalButton").click()}catch(t){console.error(t)}},async getAccountByEmail(){try{(await f.get("/Account/email",{params:{email:this.account.email}})).data.responseData?this.emailError="Email đã được sử dụng.":this.emailError=""}catch(t){console.error(t)}},handleSubmit(){this.isEditMode?this.updateAccount():this.createAccount()},getRoles(){f.get("/Role",null).then(t=>{this.roles=t.data.responseData}).catch(t=>console.log(t))},resetForm(){console.log("resetForm đã được gọi"),this.account={id:"",email:"",password:"",fullName:"",phoneNumber:"",roleId:2},this.emailError="",this.$refs.form.resetForm(),this.$refs.form.setErrors({})},clearEmailError(){this.emailError=""}},components:{Form:V,Field:D,ErrorMessage:B},emits:{"account-saved":null}},W={key:0},Y={key:1},Z={class:"row mb-3 form-group required"},ee=e("label",{for:"email",class:"col-sm-2 col-form-label control-label text-end"},"Email",-1),te={class:"col-sm-9"},oe={key:0,class:"text-danger"},se={key:1,class:"text-danger"},ae={key:0,class:"row mb-3 form-group required"},ne=e("label",{for:"password",class:"col-sm-2 col-form-label control-label text-end"}," Mật khẩu ",-1),le={class:"col-sm-9"},ce={class:"row mb-3 form-group required"},re=e("label",{for:"fullName",class:"col-sm-2 col-form-label control-label text-end"}," Họ tên ",-1),ie={class:"col-sm-9"},de={class:"row mb-3 form-group required"},ue=e("label",{for:"phoneNumber",class:"col-sm-2 col-form-label control-label text-end"},"Điện thoại",-1),me={class:"col-sm-9"},he={class:"row mb-3 form-group required"},pe=e("label",{for:"authority",class:"col-sm-2 col-form-label control-label text-end"},"Quyền",-1),_e={class:"col-sm-9"},ge=e("option",{selected:"",disabled:""},"Select Role",-1),fe=["value"],be=e("div",{class:"modal-footer align-content-center justify-content-center"},[e("button",{type:"submit",class:"btn btn-primary"},[e("i",{class:"fa-solid fa-floppy-disk mx-1"}),_(" Lưu ")]),e("button",{id:"closeModalButton",type:"button",class:"btn-close","data-bs-dismiss":"modal",hidden:""})],-1);function ye(t,o,c,g,a,h){const u=D,i=B,p=V,b=z;return l(),T(b,{id_model:c.id_modal,data_bs_target_modal:c.data_bs_target_modal,onCloseModal:h.resetForm},{icon:d(()=>[v(t.$slots,"icon")]),title:d(()=>[c.isEditMode?(l(),r("span",Y,[v(t.$slots,"header",{},()=>[_("Cập nhật tài khoản")])])):(l(),r("span",W,[v(t.$slots,"header",{},()=>[_("Thêm tài khoản")])]))]),body:d(()=>[n(p,{onSubmit:h.handleSubmit,ref:"form"},{default:d(()=>[e("div",Z,[ee,e("div",te,[n(u,{type:"text",modelValue:a.account.email,"onUpdate:modelValue":o[0]||(o[0]=s=>a.account.email=s),name:"email",class:"form-control",rules:{required:!0,email:!0},onInput:h.clearEmailError},null,8,["modelValue","onInput"]),n(i,{name:"email",class:"text-danger"}),a.emailError==="Email này đã tồn tại."?(l(),r("span",oe,m(a.emailError),1)):A("",!0),a.emailError==="Thông tin này không được để trống!"?(l(),r("span",se,m(a.emailError),1)):A("",!0)])]),c.isEditMode?A("",!0):(l(),r("div",ae,[ne,e("div",le,[n(u,{name:"password",rules:{required:!0,min:5,password:!0},modelValue:a.account.password,"onUpdate:modelValue":o[1]||(o[1]=s=>a.account.password=s),type:"password",class:"form-control"},null,8,["modelValue"]),n(i,{name:"password",class:"text-danger"})])])),e("div",ce,[re,e("div",ie,[n(u,{name:"fullName",modelValue:a.account.fullName,"onUpdate:modelValue":o[2]||(o[2]=s=>a.account.fullName=s),type:"text",class:"form-control",rules:{required:!0,onlyCharacters:!0}},null,8,["modelValue"]),n(i,{name:"fullName",class:"text-danger"})])]),e("div",de,[ue,e("div",me,[n(u,{name:"phoneNumber",modelValue:a.account.phone,"onUpdate:modelValue":o[3]||(o[3]=s=>a.account.phone=s),type:"text",class:"form-control",rules:{required:!0,phone:!0}},null,8,["modelValue"]),n(i,{name:"phoneNumber",class:"text-danger"})])]),e("div",he,[pe,e("div",_e,[n(u,{as:"select",name:"roleId",modelValue:a.account.roleId,"onUpdate:modelValue":o[4]||(o[4]=s=>a.account.roleId=s),class:"form-select"},{default:d(()=>[ge,(l(!0),r(E,null,k(c.roles,s=>(l(),r("option",{value:s.id},m(s.roleName),9,fe))),256))]),_:1},8,["modelValue"])])]),be]),_:1},8,["onSubmit"])]),_:3},8,["id_model","data_bs_target_modal","onCloseModal"])}const U=M(K,[["render",ye]]),S=t=>(H("data-v-ef281b31"),t=t(),L(),t),ve=S(()=>e("p",null,"Bạn có chắc chắn muốn xóa tài khoản này?",-1)),Ae=S(()=>e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Hủy bỏ ",-1)),we=S(()=>e("i",{class:"fa-regular fa-trash-can mx-1"},null,-1)),Ee={__name:"DeleteAccountModal",props:{accountId:{type:String,required:!0}},emits:["account-deleted","hide-modal"],setup(t,{emit:o}){const c=N.useToast(),g=t,a=new x,h=o,u=()=>{const i=g.accountId;a.deleteById("/Account",i).then(p=>{h("account-deleted",i),h("hide-modal"),$(".btn-close").click(),c.success("Xóa thành công")}).catch(p=>{console.error("Lỗi khi xóa tài khoản:",p)})};return(i,p)=>{const b=z;return l(),T(b,{id_model:"deleteAccountModal"},{icon:d(()=>[v(i.$slots,"icon",{},void 0,!0)]),title:d(()=>[v(i.$slots,"header",{},()=>[_("Xóa tài khoản")],!0)]),body:d(()=>[ve,e("div",{class:"modal-footer align-content-center justify-content-center"},[Ae,e("button",{type:"button",class:"btn btn-danger",onClick:u},[we,_(" Xóa ")])])]),_:3})}}},R=M(Ee,[["__scopeId","data-v-ef281b31"]]),ke={action:""},Me=e("div",{class:"mt-3"},"Tìm kiếm:",-1),xe={class:"search-text d-flex"},$e={class:"col-md-3"},Se=e("span",{class:"button d-flex"},[e("button",{class:"ms-2 me-1 btn btn-primary",type:"submit"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"})]),_("Tìm kiếm ")])],-1),Ce={__name:"Search",setup(t){const o=q("");return(c,g)=>(l(),r("form",ke,[Me,e("div",xe,[e("div",$e,[F(e("input",{"onUpdate:modelValue":g[0]||(g[0]=a=>P(o)?o.value=a:null),class:"form-control col-md-2",type:"text",placeholder:"Nhập... "},null,512),[[j,O(o)]])]),Se])]))}},Ie=Ce;q(0);const w=new x,Ne=Q({name:"index",data(){return{accounts:[],roles:[],currentEmail:"",selectedAccountId:null,editAccountData:{},isEditMode:!1,searchString:"",id_modal:"create-account-modal",data_bs_target_modal:"#create-account-modal"}},mounted(){this.currentEmail=localStorage.getItem("email"),this.getAccounts(),this.getRoles()},methods:{getAccounts(){w.get("/Account/All",null).then(t=>{this.accounts=t.data.responseData}).catch(t=>console.log(t))},getRoles(){w.get("/Role",null).then(t=>{this.roles=t.data.responseData}).catch(t=>console.log(t))},deleteAccount(t){this.selectedAccountId=t},resetPasswordAccount(t){this.selectedAccountId=t},accountEdit(t){this.editAccountData={...t},this.isEditMode=!0,this.id_modal="update-account-modal",this.data_bs_target_modal="#update-account-modal"},onCreateMode(){this.isEditMode=!1,this.id_modal="create-account-modal",this.data_bs_target_modal="#create-account-modal",this.editAccountData={id:"",email:null,password:null,fullName:null,phone:null,roleId:2}},searchByEmailOrName(){if(!this.searchString){this.getAccounts();return}/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.searchString)?w.get(`/Account/${this.searchString}`,null).then(c=>{typeof c.data.responseData=="object"&&Object.keys(c.data.responseData).length>0?this.accounts=[c.data.responseData]:this.accounts=[]}):w.get(`/Account/searchByName/${this.searchString}`,null).then(c=>{this.accounts=c.data.responseData})},resetSearchForm(){this.searchString="",this.getAccounts()}},components:{Search:Ie,DeleteAccountModal:R,TheFormCreateUpdateAccount:U}}),Ve={class:"row"},De={class:"p-4"},Be={class:"search"},Te=e("h4",{class:"search-text"},"Quản lý tài khoản",-1),qe=e("div",{class:"mt-3"},"Tìm kiếm:",-1),Fe={class:"search-text d-flex align-content-center"},je={class:"col-md-3"},ze=e("span",{class:"button d-flex"},[e("button",{class:"ms-2 btn-sm me-1 btn btn-primary",type:"submit"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1.5em",height:"1.5em",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5S14 7.01 14 9.5S11.99 14 9.5 14"})]),_("Tìm kiếm ")])],-1),Ue={class:"data"},Re={class:"btn-handle d-flex justify-content-end mb-3"},He={class:"handle-create"},Le=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"2em",height:"2em",viewBox:"0 0 256 256"},[e("path",{fill:"currentColor",d:"M208 32H48a16 16 0 0 0-16 16v160a16 16 0 0 0 16 16h160a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16m-24 104h-48v48a8 8 0 0 1-16 0v-48H72a8 8 0 0 1 0-16h48V72a8 8 0 0 1 16 0v48h48a8 8 0 0 1 0 16"})],-1),Oe=[Le],Pe={class:"table text-center table-hover table-striped-columns table-success"},Qe=e("thead",{class:"table-primary"},[e("tr",null,[e("th",{scope:"col"},"No."),e("th",{scope:"col"},"Email"),e("th",{scope:"col"},"Họ tên"),e("th",{scope:"col"},"Số điện thoại"),e("th",{scope:"col"},"Quyền"),e("th",{scope:"col"},"Tác vụ")])],-1),Xe={class:"p-2"},Ge={key:0},Je={key:0,class:"d-flex justify-content-center align-content-center align-items-center"},Ke=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 24 24"},[e("path",{fill:"currentColor",d:"M5 18.08V19h.92l9.06-9.06l-.92-.92z",opacity:"0.3"}),e("path",{fill:"currentColor",d:"M20.71 7.04a.996.996 0 0 0 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29s-.51.1-.7.29l-1.83 1.83l3.75 3.75zM3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM5.92 19H5v-.92l9.06-9.06l.92.92z"})],-1),We=e("i",{class:"fa-solid fa-key",style:{"font-size":"0.77em"}},null,-1),Ye=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",viewBox:"0 0 48 48"},[e("path",{fill:"currentColor",d:"M20 10.5v.5h8v-.5a4 4 0 0 0-8 0m-2.5.5v-.5a6.5 6.5 0 1 1 13 0v.5h11.25a1.25 1.25 0 1 1 0 2.5h-2.917l-2 23.856A7.25 7.25 0 0 1 29.608 44H18.392a7.25 7.25 0 0 1-7.224-6.644l-2-23.856H6.25a1.25 1.25 0 1 1 0-2.5zm4 9.25a1.25 1.25 0 1 0-2.5 0v14.5a1.25 1.25 0 1 0 2.5 0zM27.75 19c-.69 0-1.25.56-1.25 1.25v14.5a1.25 1.25 0 1 0 2.5 0v-14.5c0-.69-.56-1.25-1.25-1.25"})],-1),Ze=e("div",{class:"d-flex justify-content-between mt-4"},[e("div")],-1);function et(t,o,c,g,a,h){const u=U,i=G,p=J,b=R;return l(),r("div",Ve,[e("div",De,[e("div",Be,[Te,e("form",{name:"search",onSubmit:o[1]||(o[1]=X(s=>t.searchByEmailOrName(),["prevent"]))},[qe,e("div",Fe,[e("div",je,[F(e("input",{class:"form-control col-md-2","onUpdate:modelValue":o[0]||(o[0]=s=>t.searchString=s),type:"text",placeholder:"Nhập email hoặc họ tên... "},null,512),[[j,t.searchString]])]),ze])],32)]),e("div",Ue,[e("div",Re,[e("div",He,[n(u,{isEditMode:t.isEditMode,roles:t.roles,id_modal:"create-account-modal",data_bs_target_modal:"#create-account-modal",onAccountSaved:t.getAccounts},null,8,["isEditMode","roles","onAccountSaved"]),e("a",{onClick:o[2]||(o[2]=(...s)=>t.onCreateMode&&t.onCreateMode(...s)),href:"#","data-bs-toggle":"modal","data-bs-target":"#create-account-modal"},Oe)])]),e("table",Pe,[Qe,e("tbody",null,[(l(!0),r(E,null,k(t.accounts,(s,C)=>(l(),r("tr",{key:C},[e("td",null,m(++C),1),e("td",Xe,m(s.email),1),e("td",null,m(s.fullName),1),e("td",null,m(s.phone),1),e("td",null,[(l(!0),r(E,null,k(t.roles,y=>(l(),r("span",null,[y.id===s.roleId?(l(),r("span",Ge,m(y.roleName),1)):A("",!0)]))),256))]),e("td",null,[s.email!==t.currentEmail?(l(),r("div",Je,[n(i,{class:"link link-primary text-decoration-none mx-1","data-bs-toggle":"modal","data-bs-target":"#update-account-modal",onClick:y=>t.accountEdit(s),style:{cursor:"pointer"}},{default:d(()=>[Ke]),_:2},1032,["onClick"]),n(i,{class:"link link-primary text-decoration-none mx-1","data-bs-toggle":"modal","data-bs-target":"#changePasswordModal",onClick:y=>t.resetPasswordAccount(s.id),style:{cursor:"pointer"}},{default:d(()=>[We]),_:2},1032,["onClick"]),n(i,{class:"link link-danger text-decoration-none mx-1",style:{cursor:"pointer"},onClick:y=>t.deleteAccount(s.id),"data-bs-toggle":"modal","data-bs-target":"#deleteAccountModal"},{default:d(()=>[Ye]),_:2},1032,["onClick"])])):A("",!0)])]))),128))])]),n(u,{isEditMode:t.isEditMode,editAccount:t.editAccountData,roles:t.roles,id_modal:"update-account-modal",data_bs_target_modal:"#update-account-modal",onAccountSaved:t.getAccounts},null,8,["isEditMode","editAccount","roles","onAccountSaved"]),n(p,{accountId:t.selectedAccountId,isAdminChangeMode:!0},null,8,["accountId"]),n(b,{accountId:t.selectedAccountId,onAccountDeleted:t.getAccounts},null,8,["accountId","onAccountDeleted"]),Ze])])])}const lt=M(Ne,[["render",et]]);export{lt as default};
